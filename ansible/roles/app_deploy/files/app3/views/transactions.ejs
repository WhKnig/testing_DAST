<%- include('header') %>

    <h1 class="card-title">Transaction History</h1>

    <div class="card">
        <form action="/transactions" method="GET" style="display: flex; gap: 1rem; margin-bottom: 2rem;">
            <input type="hidden" name="account" value="<%= accountId %>">
            <input type="text" name="search" placeholder="Search transactions..." class="form-control"
                value="<%= search || '' %>">
            <button type="submit" class="btn" style="width: auto; margin-top: 0;">Search</button>
        </form>

        <% if (search) { %>
            <!-- VULN: Reflected XSS (Using <%- %> which does not escape HTML) -->
            <p>Results for: <b><%- search %></b></p>
            <% } %>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th style="text-align: right;">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% transactions.forEach(function(tx) { %>
                            <tr>
                                <td>
                                    <%= new Date(tx.date).toLocaleDateString() %>
                                </td>
                                <td><%- tx.description %></td> <!-- Potential Stored XSS -->
                                <td style="text-align: right;"
                                    class="<%= tx.amount >= 0 ? 'amount-pos' : 'amount-neg' %>">
                                    <%= tx.amount %>
                                </td>
                            </tr>
                            <% }); %>
                    </tbody>
                </table>
    </div>

    <%- include('footer') %>